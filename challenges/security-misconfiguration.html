<div class="challenge-content">
    <h2>Security Misconfiguration Challenge</h2>
    <p>A critical security configuration has been exposed through obfuscated JavaScript code. Deobfuscate the code to reveal the hidden secrets.</p>
    
    <div class="info-box">
        <strong>Challenge:</strong> The JavaScript code is heavily obfuscated using string array lookups and computed property names. The flag has been split into 3 parts, each encoded differently (Base64 reversed, Hex, XOR+Base64). You must deobfuscate the code, execute it, analyze the configuration object, decode each part, and reconstruct the complete flag.
    </div>
    
    <div class="warning-box">
        <strong>Note:</strong> This challenge requires deep understanding of JavaScript execution and code analysis techniques.
    </div>
    
    <h3>Obfuscated Code</h3>
    <pre id="obfuscated-code"></pre>
    
    <h3>Code Execution</h3>
    <div class="info-box">
        <p>Try executing the code in the browser console to see what it does. Look for exposed API keys, secrets, or misconfigurations.</p>
        <button class="btn-submit" onclick="executeObfuscatedCode()">Execute Code</button>
        <div id="execution-result" class="mt-2"></div>
    </div>
    
    <div class="flag-submission">
        <h3>Submit Flag</h3>
        <div class="flag-input-group">
            <input type="text" id="flag-input" placeholder="CTF{...}" />
            <button class="btn-submit" id="submit-flag-btn">Submit</button>
        </div>
        <div id="flag-result" class="hidden"></div>
    </div>
    
    <div class="hints-section">
        <h3>Hints</h3>
        <div class="hint-item">
            <button class="hint-toggle" onclick="toggleHint('hint-1')">
                Hint 1 <span id="hint-1-arrow">▼</span>
            </button>
            <div id="hint-1" class="hint-content hidden">
                The obfuscation uses string arrays (_0x1a2b, _0x3c4d) and computed property names. Execute the code to see the actual config object. The flag parts are stored in properties like flagpart1, secretpart2, exposedpart3, and also in metadata hashes.
            </div>
        </div>
        <div class="hint-item">
            <button class="hint-toggle" onclick="toggleHint('hint-2')">
                Hint 2 <span id="hint-2-arrow">▼</span>
            </button>
            <div id="hint-2" class="hint-content hidden">
                After executing, check the config object's properties. Part 1 is Base64 encoded then reversed. Part 2 is hex encoded. Part 3 is XORed (0x55) then Base64 encoded with '|' separators. Decode each part and combine them in order.
            </div>
        </div>
    </div>
</div>

<script>
// Make executeObfuscatedCode available globally
window.executeObfuscatedCode = function() {
    const resultDiv = document.getElementById('execution-result');
    if (!window.obfuscatedFunction) {
        if (resultDiv) {
            resultDiv.innerHTML = '<div class="flag-message error">Obfuscated function not loaded. Check the page source.</div>';
        }
        return;
    }
    
    try {
        const result = window.obfuscatedFunction();
        if (resultDiv) {
            resultDiv.innerHTML = `<div class="flag-message success">Execution result: ${result}</div>`;
        }
    } catch (e) {
        if (resultDiv) {
            resultDiv.innerHTML = `<div class="flag-message error">Error: ${e.message}</div>`;
        }
    }
};
</script>

